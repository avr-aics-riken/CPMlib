/*
 * CPMlib - Cartesian Partition Manager Library
 *
 * Copyright (C) 2012-2014 Institute of Industrial Science, The University of Tokyo.
 * All rights reserved.
 *
 * Copyright (c) 2014-2015 Advanced Institute for Computational Science, RIKEN. 
 * All rights reserved.
 *
 */


SOFTWARE REQUIREMENT
====================

- MPI library
- Text Parser library



HOW TO BUILD
============

1) with configure

$ export FFV_HOME=hogehoge
$ cd BUILD_DIR
$ ../configure [options]
$ make
$ make install


Configure options:

 --host=hostname
    Specify in case of cross-compilation.

 --prefix=INSTALL_DIR
    Specify a directory to be installed. The default directory is /usr/local/CPMlib.

 --with-comp=(INTEL|FJ|GNU)
    If Intel compiler is used, choose INTEL, and if Fujitsu compiler, specify FJ. 
    This option is mandatory when using both compilers.

 --with-example=(no|yes)
    Specify building example. The default is no.

 --with-f90example=(no|yes)
    Specify building f90 example. The default is no. If yes, it is required to specify F90,
    F90FLAGS and LDFLAGS.

 --with-f90real=(4|8)
    Specify the REAL_TYPE macro by selecting 4(float) or 8(double). If this option is 
    omitted, float type will be used.

 --with-impi=IntelMPI_DIR
    If you use an IntelMPI library, specify this option and use wrapper compiler driver.
    If you exploit to use mpiifort for FC or F90, configure script recognizes that you
    specified this option.

 --with-mpich=MPICH_DIR
    If you will use a MPICH library, specify the directory that MPICH library is
    installed. Either --with-mpich of --with-ompi option will be required except. 
    If the wrapper compiler, e.g., mpic++ or mpicxx is used to compile, both options 
    can be eliminated.

 --with-ompi=OPENMPI_DIR
    If you will use an OpenMPI library, specify the directory path of OpenMPI.

 --with-parser=TEXTPARSER_PATH
    Specify the directory path that is installed TextParser library.

 --with-pm=PMLIB_DIR
    Specify the directory path that Performance Monitor library is installed. This 
    option is required if only you need a performance report.


 CC=C_COMPILER
    Specify a C compiler. *

 CFLAGS=C_OPTIONS
    Specify compiler options. *

 CXX=CXX_COMPILER
    Specify a C++ compiler, e.g., g++, icpc, xlc++ or others.

 CXXFLAGS=CXX_OPTIONS
    Specify compiler options.

 F90=FORTRAN90_COMPILER
    Specify a fortran90 compiler. *

 F90FLAGS=FORTRAN90_OPTIONS
    Specify compiler options. *

 LDFLAGS=LD_OPTIONS
    Specify directory path for Fortran libraries. *

 * This option affect only example.





2) Configure Examples

# INTEL compiler

## MPI by a wrapper

### /wo examples
$ ../configure --prefix=${FFV_HOME}/CPMlib \
               --with-pm=${FFV_HOME}/PMlib \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=INTEL \
               CXX=mpicxx \
               CXXFLAGS=-O3 \
               F90=mpif90 \
               F90FLAGS=-O3

### /w examples
$ ../configure --prefix=${FFV_HOME}/CPMlib \
               --with-pm=${FFV_HOME}/PMlib \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=INTEL \
               --with-f90example=yes \
               --with-example=yes \
               CXX=mpicxx \
               CXXFLAGS=-O3 \
               F90=mpif90 \
               F90FLAGS=-O3


### Alternation
$ ../configure --with-pm=${FFV_HOME}/PMlib \
               --with-ompi=/opt/openmpi \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=INTEL \
               --with-f90example=yes \
               --with-example=yes \
               CXX=icpc \
               CXXFLAGS=-O3 \
               F90=ifort \
               F90FLAGS=-O3 \
               LDFLAGS=-L/opt/intel/composerxe/lib/intel64



# GNU compiler

## MPICH
$ ../configure --with-pm=${FFV_HOME}/PMlib \
               --with-mpich=/usr/local/mpich \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=GNU \
               CXX=g++ \
               CXXFLAGS=-O3 \
               F90=gfortran \
               F90FLAGS=-O3 \
               LDFLAGS="-L/usr/local/gfortran/lib -lgfortran"

## OpenMPI using a wrapper compiler, /w examples
$ ../configure --prefix=${FFV_HOME}/CPMlib \
               --with-pm=${FFV_HOME}/PMlib \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=GNU \
               --with-f90example=yes \
               --with-example=yes \
               CXX=mpicxx \
               CXXFLAGS=-O3 \
               F90=mpif90 \
               F90FLAGS=-O3 \
               LDFLAGS="-L/usr/local/gfortran/lib -lgfortran"



# FUJITSU compiler / FX, K computer

## On login node, /wo f90 example
$ ../configure --prefix=${FFV_HOME}/CPMlib \
               --with-pm=${FFV_HOME}/PMlib \
               --with-parser=${FFV_HOME}/TextParser \
               --with-comp=FJ \
               --with-f90example=no \
               --host=sparc64-unknown-linux-gnu \
               CXX=mpiFCCpx \
               CXXFLAGS=-Kfast \
               F90=mpifrtpx \
               F90FLAGS=-Kfast



3) Hand compile

If a provided configure does not work, use Makefile_hand to build this library. At first,
edit a make_setting file to tell your machine environment.
