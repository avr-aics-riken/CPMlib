/*
 * CPMlib - Cartesian Partition Manager Library
 *
 * Copyright (C) 2012-2013 Institute of Industrial Science, The University of Tokyo.
 * All rights reserved.
 *
 */


SOFTWARE REQUIREMENT
====================
- MPI library
- Text parsing library



HOW TO BUILD
============

1. with configure

$ ./configure [options]
$ make
# make install


Configure options:

 --host=hostname
    Specify in case of cross-compilation.

 --prefix=INSTALL_DIR
    Specify a directory to be installed. The default directory is /usr/local/CPMlib.

 --with-comp=(INTEL|FJ)
    If Intel compiler is used, choose INTEL, and if Fujitsu compiler, specify FJ. 
    This option is mandatory when using both compilers.

 --with-f90example=(yes|no)
    Specify building f90 example. The default is yes and is required to specify F90, 
    F90FLAGS and LDFLAGS.

 --with-f90real=(4|8)
    Specify the REAL_TYPE macro by selecting 4(float) or 8(double). If this option is 
    omitted, float type will be used.

 --with-mpich=MPICH_DIR
    If you will use a MPICH library, specify the directory that MPICH library is
    installed. Either --with-mpich of --with-ompi option will be required except. 
    If the wrapper compiler, e.g., mpic++ or mpicxx is used to compile, both options 
    can be eliminated.

 --with-ompi=OPENMPI_DIR
    If you will use an OpenMPI library, specify the directory path of OpenMPI.

 --with-parser=TEXTPARSER_PATH
    Specify the directory path that is installed TextParser library.

 --with-pm=PMLIB_DIR
    Specify the directory path that Performance Monitor library is installed. This 
    option is required if only you need a performance report.


 CC=C_COMPILER
    Specify a C compiler. *

 CFLAGS=C_OPTIONS
    Specify compiler options. *

 CXX=CXX_COMPILER
    Specify a C++ compiler, e.g., g++, icpc, xlc++ or others.

 CXXFLAGS=CXX_OPTIONS
    Specify compiler options.

 F90=FORTRAN90_COMPILER
    Specify a fortran90 compiler. *

 F90FLAGS=FORTRAN90_OPTIONS
    Specify compiler options. *

 LDFLAGS=LD_OPTIONS
    Specify directory path for Fortran libraries. *

 * Mark means that this option does not affect any because CPMlib itself is compiled 
   by C++.



Here is examples.

# for OpenMPI compiled by Intel compiler and using wrapper compiler, /w f90 example

  $ ./configure --with-pm=/usr/local/PMlib \
                --with-parser=/usr/local/TextParser \
                --with-comp=INTEL \
                --with-f90example=yes \
                CXX=mpicxx \
                CXXFLAGS=-O3 \
                F90=mpif90 \
                F90FLAGS=-O3


# for Intel compiler and OpenMPI.

  $ ./configure --with-pm=/usr/local/PMlib \
                --with-ompi=/opt/openmpi \
                --with-parser=/usr/local/TextParser \
                --with-comp=INTEL \
                CXX=icpc \
                CXXFLAGS=-O3 \
                F90=ifort \
                F90FLAGS=-O3 \
                LDFLAGS=-L/opt/intel/composerxe/lib/intel64


# for GNU compiler and MPICH.

  $ ./configure --with-pm=/usr/local/PMlib \
                --with-mpich=/usr/local/mpich \
                --with-parser=/usr/local/TextParser \
                CXX=g++ \
                CXXFLAGS=-O3 \
                F90=gfortran \
                F90FLAGS=-O3 \
                LDFLAGS=-lgfortran


# for K-computer. cross-compiling, /wo f90 example

  $ ./configure --prefix=$1 \
                --with-pm=/hogehoge \
                --with-comp=FJ \
                --with-f90example=no \
                --host=sparc64-unknown-linux-gnu \
                CXX=mpiFCCpx \
                CXXFLAGS=-Kfast



2. How to use config_cpm.sh

  $ ./config_cpm.sh install_dir

  Specify the directory that you want to install by argument 'install_dir'.


$ cat config_cpm.sh
#! /bin/sh
#
# at .bashrc
#
# Compiler options:
#
#   --with-comp=INTEL|FJ       This option is mandatory if either compiler is specified.
#   --with-ompi=/hoge          In case of using wrapper compiler, this option may be 
#                              omitted.
#   --with-pm=/foo             Specify the directory that the PMlib is installed.
#   --with-f90real=4|8         Specify real type in fortran
#   --with-f90example=yes|no   Specify compilation of fortran sample included. 
#   --host=hostname            Specify in case of cross-compilation.
#
# Usage : ./config_cpm.sh install_directory
#
#
./configure --prefix=$1 \
            --with-comp=INTEL \
            --with-ompi=/opt/openmpi \
            --with-parser=/usr/local/TextParser \
            --with-pm=/usr/local/PMlib \
            --with-f90example=yes \
            CXX=icpc \
            CXXFLAGS=-O3 \
            F90=ifort \
            F90FLAGS=-O3 \
            LDFLAGS=-L/opt/intel/composerxe/lib/intel64



3. Hand compile

If a provided configure does not work, use Makefile_hand to build this library. At first,
edit a make_setting file to tell your machine environment.

