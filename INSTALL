/*
 * CPMlib - Cartesian Partition Manager Library
 *
 * Copyright (C) 2012-2013 Institute of Industrial Science, The University of Tokyo.
 * All rights reserved.
 *
 */


Prerequisite
============
- MPI library
- Text parsing library



How to compile
==============

1. with configure

$ ./configure [options]
$ make
# make install


Configure options:

 --prefix=INSTALL_DIR
    Specify a directory to be installed. The default directory is /usr/local/CPMlib.

 --with-mpich=MPICH_DIR
    If you will use a MPICH library, specify the directory that MPICH library is installed.
    Either --with-mpich of --with-ompi option will be required except. If the wrapper compiler,
    e.g., mpic++ or mpicxx is used to compile, both options can be eliminated.

 --with-ompi=OPENMPI_DIR
    If you will use an OpenMPI library, specify the directory path of OpenMPI.

 --with-comp=(INTEL|FJ)
    If Intel compiler is used, choose INTEL, and if Fujitsu compiler, specify FJ. This option 
    is mandatory when using both compilers.

 --with-pm=PMLIB_DIR
    Specify the directory path that Performance Monitor library is installed. This option is 
    required if only you need a performance report.

 --with-parser=TEXTPARSER_PATH
    Specify the directory path that is installed TextParser library.

 --with-f90real=(4|8)
    Specify the REAL_TYPE macro by selecting 4(float) or 8(double). If this option is omitted,
    float type will be used.

 --with-f90example=(yes|no)
    Specify building f90 example. The default is yes and is required to specify F90, F90FLAGS and LDFLAGS.

 --host=hostname
    Specify in case of cross-compilation.


 CC=C_COMPILER
    Specify a C compiler. *

 CFLAGS=C_OPTIONS
    Specify compiler options. *

 CXX=CXX_COMPILER
    Specify a C++ compiler, e.g., g++, icpc, xlc++ or others.

 CXXFLAGS=CXX_OPTIONS
    Specify compiler options.

 FC=FORTRAN90_COMPILER
    Specify a fortran compiler. *

 FCFLAGS=FORTRAN_OPTIONS
    Specify compiler options. *

 F90=FORTRAN90_COMPILER
    Specify a fortran90 compiler. *

 F90FLAGS=FORTRAN90_OPTIONS
    Specify compiler options. *

 LDFLAGS=LD_OPTIONS
    Specify directory path for Fortran libraries. *

 * Mark means that this option does not affect any because CPMlib itself is compiled by C++.



Here is a example for Intel compiler and MPICH.

$.configure --with-pm=/usr/local/CPMlib \
            --with-mpich=/usr/local/mpich \
            --with-parser=/usr/local/TextParser \
            --with-comp=INTEL \
            CXX=/opt/intel/composerxe/bin/icpc \
            CXXFLAGS=-O3 \
            F90=/opt/intel/composerxe/bin/ifort \
            F90FLAGS=-O3 \
            LDFLAGS=-L/opt/intel/composerxe/lib/intel64


Following example is for K-computer.

$./configure --prefix=$1 \
	     --with-pm=/hogehoge \
             --with-comp=FJ \
             --with-log=enable \
             --host=sparc64-unknown-linux-gnu \
             CXX=mpiFCCpx \
             CXXFLAGS=-Kfast \
	     FC=



2. How to use config_cpm.sh

  $ ./config_cpm.sh install_dir

  Specify the directory that you want to install by argument 'install_dir'.


$ cat config_cpm.sh
#! /bin/sh
#
# at .bashrc
#
# Compiler options:
#
#   --with-comp=INTEL|FJ;      If compiler does not fall under the category, this option is blank.
#   --with-ompi=/hoge;         In case of using wrapper compiler, this option may be omitted.
#   --with-f90real=4|8;        Specify real type in fortran
#   --with-f90example=yes|no;  Specify compilation of fortran sample included. 
#   --host=hostname;           Specify in case of cross-compilation.
#
#
./configure --prefix=$1 \
            --with-comp=INTEL \
            --with-ompi=/opt/openmpi \
            --with-parser=/usr/local/TextParser \
            --with-f90example=no \
            CXX=icpc \
            CXXFLAGS=-O3 \
            FC=ifort



3. Hand compile

If a provided configure does not work, use Makefile_hand to build this library. At first,
edit a make_setting file to tell your machine environment.

